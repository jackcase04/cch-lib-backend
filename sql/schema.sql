DROP TABLE IF EXISTS request CASCADE;
DROP TABLE IF EXISTS write CASCADE;
DROP TABLE IF EXISTS manage_equipment CASCADE;
DROP TABLE IF EXISTS manage_book CASCADE;
DROP TABLE IF EXISTS equipment CASCADE;
DROP TABLE IF EXISTS book CASCADE;
DROP TABLE IF EXISTS author CASCADE;
DROP TABLE IF EXISTS users CASCADE;

DROP TYPE IF EXISTS request_type;
DROP TYPE IF EXISTS medium;

CREATE TYPE medium AS enum ('physical', 'pdf');

CREATE TYPE request_type AS enum ('checkout', 'return');

CREATE TABLE users (
    user_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR(80) NOT NULL,
    password VARCHAR(80) NOT NULL,
    f_name VARCHAR(80),
    m_init VARCHAR(80),
    l_name VARCHAR(80),
    is_admin BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE author (
    author_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    f_name VARCHAR(80),
    m_init VARCHAR(80),
    l_name VARCHAR(80)
);

CREATE TABLE book (
    book_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR(80) NOT NULL,
    course VARCHAR(80),
    book_edition VARCHAR(80),
    condition medium NOT NULL,
    isbn INTEGER,
    additional_info VARCHAR(80),
    checked_out BOOLEAN NOT NULL DEFAULT FALSE,
    pdf_id INTEGER,
    contact INTEGER NOT NULL REFERENCES users(user_id),
    -- Book can be checked out only by one users at a time
    checked_out_by INTEGER REFERENCES users(user_id)
);

CREATE TABLE equipment (
    equipment_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    equipment_name VARCHAR(80) NOT NULL,
    class_requirement VARCHAR(80),
    checked_out BOOLEAN DEFAULT FALSE,
    additional_info VARCHAR(80),
    contact INTEGER NOT NULL REFERENCES users(user_id),
    -- Equipment can be checked out only by one user at a time
    checked_out_by INTEGER REFERENCES users(user_id)
);

CREATE TABLE write (
    author_id INTEGER NOT NULL REFERENCES author(author_id),
    book_id INTEGER NOT NULL REFERENCES book(book_id)
);

CREATE TABLE request (
    request_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    book_id INTEGER REFERENCES book(book_id),
    equipment_id INTEGER REFERENCES equipment(equipment_id),
    -- TODO: Add constraint to ensure only 1 resource can be refrenced
    user_id INTEGER NOT NULL REFERENCES users(user_id),
    time_requested TIMESTAMP NOT NULL,
    approved BOOLEAN NOT NULL DEFAULT FALSE,
    request_type request_type NOT NULL,
    fulfilled BOOLEAN NOT NULL DEFAULT FALSE
);

INSERT INTO "public"."users" ("user_id", "email", "password", "f_name", "m_init", "l_name", "is_admin") VALUES
('1', 'test@gmail.com', '$2a$10$tdaSlXFkM6nRgwdI7HeGhuOqhR9JJqnS9c0NM.G/U4JqHYOv12UB.', 'Collin', null, 'McCord (TESTING)', 'true'),
('2', 'anothertest@gmail.com', '$2a$10$/fnAYnYMLqZwk8GxmMODhOXUQPgh1AhmiTkAegPkAPSNdKlCrHc2S', 'Maris', null, 'Reinkemeyer (TESTING)', 'true'), ('4', 'another@test.com', '$2a$10$J.issKpfsZsZENwS3CPHjuGcr7ZI96aRZYfufgwPI6F4cGr3lCVuy', 'Tester', null, 'McTester', 'false'),
('8', 'testuser@mst.edu', '$2a$10$wLtSGfSGA4N74uwAEIiG.eboj0.BQ5sMgnvlSjl8857sYqSRzEqx6', 'John', null, 'Doe', 'false'),
('9', 'janeDoe@mst.edu', '$2a$10$GebPujg/iwKqz5pQWTZp2etvskme4W8yONsK959HsBOcK.q8NfhjS', 'Jane', null, 'Doe', 'false');

INSERT INTO "public"."author" ("author_id", "f_name", "m_init", "l_name") VALUES
('1', 'Manhattan Prep', null, null),
('2', 'Walter', null, 'Savitch'),
('3', 'Warren/Lasher', null, null),
('4', 'Michael', null, 'Sullivan'),
('5', 'Black', null, null),
('6', 'Kosher', null, null),
('7', 'Tony', null, 'Reinke'),
('20', 'I write this is a test book', null, 'Johnson'),
('21', 'I also write this a test book', null, 'Smith'),
('22', 'Wow 3 authors write one book', 'L', 'Jimmy');

INSERT INTO "public"."book" ("book_id", "title", "course", "book_edition", "condition", "isbn", "additional_info", "checked_out", "pdf_id", "contact", "checked_out_by") VALUES
('2', '5 lb. Book of GRE Practice Problems', null, '3rd', 'physical', null, null, 'false', null, '1', null),
('3', 'Absolute C++', null, '6th', 'physical', null, null, 'true', null, '1', '4'),
('4', 'Accounting and Finance for Engineers', null, null, 'physical', null, null, 'true', null, '2', '2'),
('5', 'Algebra and Trigonometry', null, '2nd', 'physical', null, null, 'false', null, '1', null),
('6', 'Algebra and Trigonometry', null, '9th', 'physical', null, null, 'false', null, '1', null),
('7', 'Algebra and Trigonometry', null, '9th', 'physical', null, null, 'false', null, '1', null),
('8', 'Algebra and Trigonometry', null, '11th', 'physical', null, null, 'false', null, '1', null),
('9', 'Degarmo''s Materials and Processes in Manufacturing', 'Mech Eng 2653', '11th', 'pdf', null, null, 'false', null, '1', null),
('10', 'Degarmo''s Materials and Processes in Manufacturing', 'Mech Eng 2653', '12th', 'physical', null, null, 'false', null, '1', null),
('11', 'Competing Spectacles: Treasuring Christ in the Media Age', 'English 2410', null, 'physical', null, null, 'true', null, '2', '4'),
('24', 'Changed the name of the test book', 'Art 123', '2nd', 'pdf', null, null, 'false', null, '1', null);

INSERT INTO "public"."equipment" ("equipment_id", "equipment_name", "class_requirement", "checked_out", "additional_info", "contact", "checked_out_by") VALUES
('1', 'Calculator (Casio scientific)', null, 'false', null, '1', null),
('2', 'Lab Coat', 'Chemistry', 'false', 'Size Small', '2', null),
('3', 'Lab Coat', 'Chemistry', 'false', null, '2', null),
('4', 'Lab Coat', 'Chemistry', 'false', null, '2', null),
('5', 'TI-36X Pro Calculator', 'FE Exam', 'true', null, '1', '4'),
('9', 'Hello its me', 'CS 2300', 'false', null, '1', null);

INSERT INTO "public"."write" ("author_id", "book_id") VALUES
('2', '3'),
('3', '4'),
('4', '5'),
('4', '6'),
('4', '7'),
('4', '8'),
('5', '9'),
('5', '10'),
('6', '9'),
('6', '10'),
('7', '11'),
('20', '24'),
('21', '24'),
('22', '24');

INSERT INTO "public"."request" ("book_id", "equipment_id", "user_id", "time_requested", "approved", "request_type", "fulfilled", "request_id") VALUES
('2', null, '2', '2025-12-04 07:20:00', 'true', 'checkout', 'false', '2'),
('3', null, '2', '2025-12-04 07:24:00', 'true', 'checkout', 'false', '3'),
('2', null, '4', '2025-12-06 12:59:41.450546', 'true', 'checkout', 'false', '4'),
(null, '5', '4', '2025-12-06 13:00:22.221446', 'true', 'checkout', 'true', '5'),
('3', null, '4', '2025-12-06 14:21:09.753476', 'true', 'checkout', 'true', '7'),
('11', null, '4', '2025-12-06 21:25:53.137519', 'true', 'checkout', 'true', '8');